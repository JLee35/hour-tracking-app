<script>
    // Contains event listeners and helper functions for Specific Info Page.
    
    $("#addSpecificItem").click(function () {
        $("#addSpecificItemModal").modal('show');
    });

    function insertPhaseRow() {
        $(getPhaseRow()).insertBefore($("#specificInfoAddRow"));
    }

    function getPhaseRow() {
        var phaseNumElement = document.createElement("p");
        phaseNumElement.innerText = '(' + selectedPhase.substr(0, selectedPhase.indexOf(' ')) + ')';
        phaseNumElement.classList.add("specific-info-phase-output");

        var phaseTextElement = document.createElement("p");
        var phaseText = selectedPhase.substr(selectedPhase.indexOf(' ') + 1);
        phaseText = phaseText.replace(/[\(\)]+/g, '');

        // TODO: Dynamic word break.
        phaseTextElement.innerText = phaseText;
        phaseTextElement.classList.add("specific-info-phase-output");

        var row = document.createElement("tr");
        var phaseTitleCell = document.createElement("td");
        
        phaseTitleCell.appendChild(phaseTextElement);
        phaseTitleCell.appendChild(phaseNumElement);
        phaseTitleCell.appendChild(getRemoveBtn());
        
        row.appendChild(phaseTitleCell);

        for (var x = 0; x < 7; x++) {
            row.appendChild(getPhaseCell(phaseText));
        }

        var totalCell = document.createElement("td");
        row.appendChild(totalCell);

        return row;
    }

    function getRemoveBtn() {
        var removeBtn = document.createElement("button");
        removeBtn.classList.add("btn", "btn-link");
        removeBtn.innerHTML = "Remove";

        removeBtn.addEventListener("click", function () {
            $(this).parent().parent().remove();
        });

        return removeBtn;
    }

    function getPhaseCell(phaseText) {
        var cell = document.createElement("td");
        cell.classList.add("align-middle");
        var addBtn = document.createElement("button");
        addBtn.classList.add("btn", "add-item-btn");
        addBtn.innerHTML = "<i class='fas fa-plus' style='vertical-align:center;'></i>";

        addBtn.addEventListener("click", function (e) {
            $("#addSpecificItemHoursTitle").text(phaseText + " Hours");
            $("#addSpecificItemHoursModal").modal('show');
        });

        cell.appendChild(addBtn);
        return cell;
    }


    // Attach 'Add item' listener to add item modal.
    $("#submitNewItem").click(function () {
        insertPhaseRow();
        $("#addSpecificItemModal").modal('toggle');
    });

    // Sum up all hour totals when an item is added or removed.
    function sumTotalHours(lane) {
        // Get lane item hours.
        var hourEntries = lane.find("p.swim-lane-item-hours");
        var totalHours = 0;

        // Sum all lane item hours.
        for (x=0; x < hourEntries.length; x++) {
            totalHours += parseFloat(hourEntries[x].innerText);
        }

        // Set update lane total.
        if (totalHours != "NaN") {
            lane.find("div.swim-lane-item-total")[0].innerText = "Total: " + totalHours;
        }
    }

    $("#phaseCodeInput").change(function () {
        if ($(this).val() != "0000") {
            $("#submitNewItem").prop('disabled', false);
            selectedPhase = $(this).val();
        }

        else {
            $("#submitNewItem").prop('disabled', true);
        }
    });

    // Moves on to the supervisor review page
    $("#workerAcceptHoursBtn").click(function() {
        $("#specificInfoPage").css('display', 'none');
        $("#supervisorReviewPage").css('display', 'block');
        
        $("#progressBar3").removeClass("bg-warning");
        $("#progressBar3").addClass("bg-success");
        $("#progressBar4").removeClass("bg-danger");
        $("#progressBar4").addClass("bg-warning");

        $("#progressBar3").removeClass("progress-highlight");
        $("#progressBar4").addClass("progress-highlight");

        currentPage = "supervisorReview";

        // Update review page with employee input.
        populateReviewPage();     

        return;
    });

    // Returns to general info page
    $("#specificInfoBackBtn").click(function() {

        $("#specificInfoPage").css('display', 'none');
        $("#generalInfoPage").css('display', 'block');

        $("#progressBar3").removeClass("progress-highlight");
        $("#progressBar2").addClass("progress-highlight");
        currentPage = "generalInfoPage";       

        return;
    });
    
    // Global Variables

    var selectedPhase;

</script>